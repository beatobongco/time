<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CHRONOVIZ - Visualize and hear the passage of time.</title>
    <link rel="stylesheet" href="css/normalize.css" />
    <link rel="stylesheet" href="css/style.css">
    <meta property="og:title" content="CHRONOVIZ" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://beatobongco.com/time/" />
    <meta property="og:image" content="https://beatobongco.com/time/img/chronoviz_og.png" />
    <meta property="og:description" content="Visualize and hear the passage of time." />
    <meta name="description" content="Visualize and hear the passage of time.">
    <script>
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date(); a = s.createElement(o),
                m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
        })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-56608851-1', 'auto');
        ga('send', 'pageview');
    </script>
</head>

<body>
    <script src="js/vue.min.js"></script>
    <script src="js/moment.min.js"></script>
    <div class="app-container">
        <div id="app" v-cloak>
            <div class="bezel" v-if="interval">
                <h1>CHRONOVIZ</h1>
                <div class="watch-outer">
                    <div class="watch-inner">
                        <div class="watch-back">
                            <div class="watch-face" v-if="interval">
                                <div class="help-text" v-if="isShowingHelp">
                                    <div class="icon close-icon" @click="closeHelp"></div>
                                    <p>Visualize and hear the passage of time.</p>
                                    <ul>
                                        <li class="legend">
                                            <div class="world-icon icon"></div>&nbsp;year progress
                                        </li>
                                        <li class="legend">
                                            <div class="sun-icon icon"></div>&nbsp;waking hours (7am-11pm)
                                        </li>
                                        <li class="legend">
                                            <div class="briefcase-icon icon"></div>&nbsp;workday (Mon-Fri, 9am-5pm)
                                        </li>
                                        <li class="legend">
                                            <div class="moon-icon icon"></div>&nbsp;sleeping hours (11pm-7am)
                                        </li>
                                        <li class="legend">
                                            <div class="bell-icon icon"></div>&nbsp;toggle chime interval (minutes)
                                        </li>
                                    </ul>
                                </div>
                                <div v-else>
                                    <div class="calendar">
                                        <div class="day-of-week">{{ dayOfWeek }}</div>
                                        <div class="date">
                                            <div class="month">{{ month }}</div>
                                            <div>&nbsp;</div>
                                            <div class="day">{{ day }}</div>
                                            <div>&nbsp;</div>
                                            <div class="year">{{ year }}</div>
                                        </div>
                                    </div>
                                    <div class="graphs">
                                        <div class="year-progress">
                                            <div class="year-progress-bar progress-bar"
                                                :title="dayOfYear + '/' + totalDays + ' days'">
                                                <label for="year">
                                                    <div class="world-icon icon"></div>
                                                </label>
                                                <span>&nbsp;</span>
                                                <progress id="year" :value="yearProgress" max="100"> {{yearProgress}}%
                                                </progress>
                                                <span>&nbsp;</span>
                                                <div>{{ yearProgress }}%</div>
                                            </div>
                                        </div>
                                        <div class="day-progress">
                                            <div class="day-progress-bar progress-bar"
                                                :title="minutesElapsed + '/' + minutesInADay + ' minutes'">
                                                <label for="day">
                                                    <div class="sun-icon icon"></div>
                                                </label>
                                                <span>&nbsp;</span>
                                                <progress id="day" :value="dayProgress" max="100"> {{dayProgress}}%
                                                </progress>
                                                <span>&nbsp;</span>
                                                <div>{{ dayProgress }}%</div>
                                            </div>
                                        </div>
                                        <div class="work-day-progress">
                                            <div class="work-day-progress-bar progress-bar"
                                                :title="minutesElapsedInWorkDay + '/' + minutesInAWorkDay + ' minutes'">
                                                <label for="work-day">
                                                    <div class="briefcase-icon icon"></div>
                                                </label>
                                                <span>&nbsp;</span>
                                                <progress id="work-day" :value="workDayProgress" max="100">
                                                    {{workDayProgress}}%
                                                </progress>
                                                <span>&nbsp;</span>
                                                <div>{{ workDayProgress }}%</div>
                                            </div>
                                        </div>
                                        <div class="sleep-progress">
                                            <div class="sleep-progress-bar progress-bar"
                                                :title="minutesElapsedInSleep + '/' + minutesInASleep + ' minutes'">
                                                <label for="sleep">
                                                    <div class="moon-icon icon"></div>
                                                </label>
                                                <span>&nbsp;</span>
                                                <progress id="sleep" :value="sleepProgress" max="100">
                                                    {{sleepProgress}}%
                                                </progress>
                                                <span>&nbsp;</span>
                                                <div>{{ sleepProgress }}%</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="time">
                                        <div class="chime-controls">
                                            <div class="chime-option" @click="showHelp" title="usage instructions">
                                                <div class="help-icon icon"></div>
                                            </div>
                                            <div class="chime-option" @click="cycleChimeInterval"
                                                :title="chimeIntervalTitle">
                                                <div class="bell-icon icon"></div>
                                                <span class="chime-interval">{{ settings.chimeInterval }}</span>
                                            </div>
                                        </div>
                                        <div class="larger-time">
                                            <div class="hours">{{ hours }}</div>
                                            <div>:</div>
                                            <div class="minutes">{{ minutes }}</div>
                                        </div>
                                        <div class="smaller-time">
                                            <!-- <div>&nbsp;</div> -->
                                            <div class="seconds">{{ seconds }}</div>
                                            <div>&nbsp;</div>
                                            <div class="ampm">{{ ampm }}</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        const { createApp } = Vue

        createApp({
            data() {
                return {
                    isShowingHelp: false,
                    dayOfWeek: null,
                    year: null,
                    month: null,
                    day: null,
                    hours: null,
                    minutes: null,
                    seconds: null,
                    ampm: null,
                    interval: null,
                    chimePlayed: false,
                    settings: {
                        startOfDay: "7:00",
                        endOfDay: "23:00",
                        startOfWorkDay: "9:00",
                        endOfWorkDay: "17:00",
                        chimeInterval: "OFF"
                    },
                    // year progress
                    dayOfYear: null,
                    totalDays: null,
                    yearProgress: null,
                    // day progress
                    minutesElapsed: 0,
                    minutesInADay: null,
                    dayProgress: null,
                    // work day progress
                    minutesElapsedInWorkDay: 0,
                    minutesInAWorkDay: null,
                    workDayProgress: null,
                    // sleep progress
                    minutesElapsedInSleep: 0,
                    minutesInASleep: 0,
                    sleepProgress: null,
                }
            },
            created() {
                let dayStart = moment(this.settings.startOfDay, 'hh:mm');
                let dayEnd = moment(this.settings.endOfDay, 'hh:mm');
                this.minutesInADay = dayEnd.diff(dayStart, 'minutes');

                let sleepStart = moment(this.settings.endOfDay, 'hh:mm');
                let sleepEnd = moment(this.settings.startOfDay, 'hh:mm');
                sleepEnd.add(1, 'days');
                this.minutesInASleep = Math.abs(sleepEnd.diff(sleepStart, 'minutes'));

                let workDayStart = moment(this.settings.startOfWorkDay, 'hh:mm');
                let workDayEnd = moment(this.settings.endOfWorkDay, 'hh:mm');
                this.minutesInAWorkDay = workDayEnd.diff(workDayStart, 'minutes');

                this.interval = setInterval(() => {
                    this.tellTime()
                }, 1000);
                this.tellTime();
            },
            computed: {
                chimeIntervalTitle() {
                    return this.settings.chimeInterval === "OFF" ? "chime off" : "chime every " + this.settings.chimeInterval + " minutes";
                }
            },
            methods: {
                showHelp() {
                    this.isShowingHelp = true;
                },
                closeHelp() {
                    this.isShowingHelp = false;
                },
                tellTime() {
                    const now = moment()
                    this.dayOfWeek = now.format('ddd').toUpperCase();
                    this.year = now.format('YY');
                    this.month = now.format('MMM').toUpperCase();
                    this.day = now.format('D');
                    this.hours = now.format('hh');
                    this.minutes = now.format('mm');
                    this.seconds = now.format('ss');
                    this.ampm = now.format('a').toUpperCase();

                    // progress bars

                    this.dayOfYear = now.dayOfYear();
                    this.totalDays = now.isLeapYear() ? 366 : 365;
                    this.yearProgress = Math.round(this.dayOfYear / this.totalDays * 100);

                    let dayStart = moment(this.settings.startOfDay, 'hh:mm');
                    let dayEnd = moment(this.settings.endOfDay, 'hh:mm');
                    if (now.isBetween(dayStart, dayEnd)) {
                        this.minutesInADay = dayEnd.diff(dayStart, 'minutes');
                        this.minutesElapsed = Math.min(now.diff(dayStart, 'minutes'), this.minutesInADay);
                        this.dayProgress = Math.round(this.minutesElapsed / this.minutesInADay * 100);
                    } else {
                        this.dayProgress = 0;
                    }

                    let workDayStart = moment(this.settings.startOfWorkDay, 'hh:mm');
                    let workDayEnd = moment(this.settings.endOfWorkDay, 'hh:mm');
                    let isWeekday = now.day() > 0 && now.day() < 6;
                    if (now.isBetween(workDayStart, workDayEnd) && isWeekday) {
                        this.minutesInAWorkDay = workDayEnd.diff(workDayStart, 'minutes');
                        this.minutesElapsedInWorkDay = Math.min(now.diff(workDayStart, 'minutes'), this.minutesInAWorkDay);
                        this.workDayProgress = Math.floor(this.minutesElapsedInWorkDay / this.minutesInAWorkDay * 100);
                    } else {
                        this.workDayProgress = 0;
                    }

                    let sleepStart = moment(this.settings.endOfDay, 'hh:mm');
                    let sleepEnd = moment(this.settings.startOfDay, 'hh:mm');
                    sleepEnd.add(1, 'days');
                    if (now.isBetween(sleepStart, sleepEnd)) {
                        this.minutesInASleep = Math.abs(sleepEnd.diff(sleepStart, 'minutes'));
                        this.minutesElapsedInSleep = Math.abs(Math.min(now.diff(sleepStart, 'minutes'), this.minutesInASleep));
                        this.sleepProgress = Math.floor(this.minutesElapsedInSleep / this.minutesInASleep * 100);
                    } else {
                        this.sleepProgress = 0;
                    }

                    // play a chime every n minutes (determined by user settings)
                    let shouldPlayChime = false;
                    if (this.settings.chimeInterval === "OFF") {
                        shouldPlayChime = false;
                    } else if (this.settings.chimeInterval === 60) {
                        shouldPlayChime = this.minutes === "00";
                    } else {
                        shouldPlayChime = parseInt(this.minutes) % this.settings.chimeInterval === 0;
                    }

                    // we need a chimePlayed flag to stop the chime from playing
                    // every second when the time is divisible by the chime interval
                    if (shouldPlayChime) {
                        if (this.chimePlayed) {
                            return;
                        }
                        this.playSound();
                        this.chimePlayed = true;
                    } else {
                        this.chimePlayed = false;
                    }
                },
                playSound() {
                    console.log('play sound');
                    const audio = new Audio('audio/chime.mp3');
                    audio.play();
                },
                cycleChimeInterval() {
                    const chimeIntervals = ["OFF", 15, 30, 60];
                    const currentInterval = this.settings.chimeInterval;
                    const currentIndex = chimeIntervals.indexOf(currentInterval);
                    const nextIndex = (currentIndex + 1) % chimeIntervals.length;
                    this.settings.chimeInterval = chimeIntervals[nextIndex];
                }
            }

        }).mount('#app')

        function roundDown(number, decimalPlaces) {
            const factor = Math.pow(10, decimalPlaces);
            return Math.floor(number * factor) / factor;
        }

        function scaleApp() {
            // Responsive hack: scale the app to fit the screen
            const appWidth = 380;
            const appHeight = 380;
            const scaleFactorX = window.innerWidth / appWidth;
            const scaleFactorY = window.innerHeight / appHeight;
            console.log(scaleFactorX, scaleFactorY)
            let scaleFactor = Math.min(scaleFactorX, scaleFactorY);
            console.log(scaleFactor)
            // round to 1 decimal place
            scaleFactor = roundDown(scaleFactor, 1);
            console.log(scaleFactor)
            const appWrapper = document.querySelector('.app-container');
            appWrapper.style.transform = `scale(${scaleFactor})`;
        }

        scaleApp();

        // update scale when window size changes
        window.addEventListener('resize', scaleApp);
    </script>
</body>

</html>